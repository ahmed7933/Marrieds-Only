<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Hot Night ๐ฅ | ุงููุณุฎุฉ ุงููุงููุฉ</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800&display=swap" rel="stylesheet">
    
    <link rel="preload" as="image" href="images/cover1.webp">
    <script src="https://cdn.jsdelivr.net/npm/@fingerprintjs/fingerprintjs@3/dist/fp.min.js"></script>

    <style>
        :root { --primary: #d4af37; --accent: #e50914; --blue: #00bfff; --green: #2ecc71; --bg: #050505; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; outline: none; }
        body { margin: 0; background: radial-gradient(circle at 50% 50%, #150505 0%, #000 90%); font-family: 'Cairo'; color: white; height: 100dvh; overflow: hidden; display: flex; justify-content: center; align-items: center; }
        
        /* ุงูุดุงุดุงุช */
        .screen { display: none; width: 100%; height: 100%; position: relative; z-index: 2; flex-direction: column; align-items: center; padding: 15px; overflow-y: auto; opacity: 0; transition: opacity 0.3s; }
        .screen.active { display: flex; opacity: 1; }

        /* ุงูุชุตููู ุงูุนุงู (ููุณ ุงูุณุชุงูู ุงูุณุงุจู) */
        .login-box { background: rgba(20,20,20,0.95); border: 1px solid #333; padding: 25px; border-radius: 20px; width: 100%; max-width: 350px; text-align: center; box-shadow: 0 0 40px rgba(212, 175, 55, 0.1); }
        .input-vip { background: #111; border: 1px solid #444; padding: 12px; border-radius: 10px; color: white; width: 100%; text-align: center; margin-bottom: 15px; font-family: 'Cairo'; font-size: 1rem; }
        .btn-gold { background: linear-gradient(90deg, #d4af37, #b8860b); color: black; font-weight: bold; padding: 12px; width: 100%; border-radius: 50px; border: none; cursor: pointer; font-size: 1rem; margin-bottom: 10px; }
        
        .link-text { color: var(--primary); font-size: 0.85rem; text-decoration: underline; cursor: pointer; margin-top: 10px; display: block; }
        .success-box { border: 1px solid var(--green); background: rgba(46, 204, 113, 0.1); padding: 15px; border-radius: 10px; margin-top: 15px; display: none; }
        .code-display { font-size: 2rem; font-weight: bold; color: var(--primary); letter-spacing: 3px; margin: 10px 0; font-family: monospace; }

        /* ุจุงูู ุงูู CSS ููุฃูุนุงุจ (ููุณ ุงููุฏูู ุจุงูุธุจุท) */
        /* ... (ุงุฎุชุตุงุฑุงู ูููุณุงุญุฉุ ุงูุชุฑุถ ูุฌูุฏ CSS ุงูุฃูุนุงุจ ููุง) ... */
    </style>
</head>
<body>

    <div id="welcome-overlay" style="position:fixed; top:0; left:0; width:100%; height:100%; background:#000; z-index:9999; display:flex; justify-content:center; align-items:center; flex-direction:column; transition: opacity 0.5s;">
        <div style="font-size:3rem; margin-bottom:10px;">๐ฅ</div>
        <h1 style="color:var(--primary); font-size: 2rem;">HOT NIGHT</h1>
        <button class="btn-gold" style="width:200px; margin-top:20px;" onclick="initApp()">ุงุจุฏุฃ ุงูุณูุฑุฉ ๐</button>
    </div>

    <div id="signup" class="screen">
        <div class="login-box" style="margin-top: 20px;">
            <h2 style="color:var(--primary); margin-bottom:5px;">ุงุดุชุฑุงู ุฌุฏูุฏ โจ</h2>
            <p style="color:#888; font-size:0.8rem; margin-bottom:20px;">ุณุฌู ุจูุงูุงุชู ูุงุญุตู ุนูู ููุฏ ุงูุชูุนูู</p>
            
            <form id="signup-form" onsubmit="handleSignup(event)">
                <input type="text" id="s-name" class="input-vip" placeholder="ุงูุงุณู ุงูุซูุงุฆู" required>
                <input type="tel" id="s-phone" class="input-vip" placeholder="ุฑูู ุงููุงุชุณุงุจ" required>
                
                <select id="s-plan" class="input-vip" style="color:#aaa;">
                    <option value="1 ุดูุฑ">ุจุงูุฉ ุดูุฑ (199 ุฌ.ู)</option>
                    <option value="3 ุดููุฑ">ุจุงูุฉ 3 ุดููุฑ (499 ุฌ.ู)</option>
                    <option value="1 ุณูุฉ">ุจุงูุฉ ุณูููุฉ (999 ุฌ.ู)</option>
                </select>

                <button type="submit" class="btn-gold">ุชุณุฌูู ูุงูุญุตูู ุนูู ุงูููุฏ</button>
            </form>

            <div id="success-msg" class="success-box">
                <div style="color:var(--green); font-weight:bold;">ุชู ุงูุชุณุฌูู ุจูุฌุงุญ! โ</div>
                <p style="font-size:0.8rem; color:#ccc;">ุฎุฏ ุณูุฑูู ุดูุช ููููุฏ ุฏู ูุงุจุนุชููุง ูุตู ุงูุฏูุน ูุงุชุณุงุจ ุนุดุงู ููุนููููู:</p>
                <div class="code-display" id="generated-code">------</div>
                <button class="btn-gold" style="font-size:0.8rem; background:#333; color:white;" onclick="copyCode()">ูุณุฎ ุงูููุฏ</button>
                <div style="margin-top:10px;">
                    <a href="#" onclick="show('login')" style="color:var(--primary);">ุงูุฐูุงุจ ูุชุณุฌูู ุงูุฏุฎูู -></a>
                </div>
            </div>

            <div id="signup-footer">
                <span style="color:#666; font-size:0.8rem;">ูุนุงู ููุฏ ุชูุนููุ</span>
                <span class="link-text" onclick="show('login')">ุณุฌู ุฏุฎูู ูู ููุง</span>
            </div>
        </div>
    </div>

    <div id="login" class="screen">
        <div class="login-box" style="margin-top: 50px;">
            <div style="font-size:3rem;">๐</div>
            <h2 style="color:white; margin:10px 0;">ุชุณุฌูู ุงูุฏุฎูู</h2>
            <p style="color:#888; font-size:0.8rem; margin-bottom:30px;">ุฃุฏุฎู ุงูููุฏ ุงููู ูุตูู ุจุนุฏ ุงูุฏูุน</p>
            
            <input type="password" id="pass" class="input-vip" placeholder="ููุฏ ุงูุชูุนูู (6 ุฃุฑูุงู)">
            <button class="btn-gold" onclick="login()">ุฏุฎูู</button>
            <p id="error" style="color:var(--accent); display:none; margin-top:15px; font-size:0.9rem;"></p>

            <span class="link-text" onclick="show('signup')">ููุณ ูุฏูู ููุฏุ ุงุดุชุฑู ุงูุขู</span>
        </div>
    </div>

    <div id="dashboard" class="screen">
        <div style="color:white;">(ููุง ุชุธูุฑ ูุงุฆูุฉ ุงูุฃูุนุงุจ - ุงูุณุฎ ุงูููุฏ ุงูุณุงุจู)</div>
    </div>

    <script>
        // ==========================================
        // 0. ุฅุนุฏุงุฏุงุช ุงููุธุงู
        // ==========================================
        // โ๏ธโ๏ธ ุญุท ุฑุงุจุท ุงูุณูุฑูุจุช ุจุชุงุนู ููุง โ๏ธโ๏ธ
        const API_URL = "https://script.google.com/macros/s/AKfycbx_MDppdjfv_a3k6NNloqOUJH3tEF9B2N-sdqyz-knmGQ3156zRbT19XNpzGhKXru6XTQ/exec"; 

        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        // ... (ุฏุงูุฉ playSound ููุณ ุงูุณุงุจูุฉ) ...
        function playSound(type) { /* ... */ }

        // ... (Game Data & Instructions ููุณ ุงูุณุงุจูุฉ) ...
        const db = { /* ... */ };

        // ==========================================
        // 1. SYSTEM LOGIC
        // ==========================================
        
        function initApp() {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            document.getElementById('welcome-overlay').style.opacity = '0';
            setTimeout(() => document.getElementById('welcome-overlay').style.display = 'none', 500);

            // ูู ูุณุฌู ูุจู ูุฏูุ ุฑูุญ ููุฏุด ุจูุฑุฏุ ูู ูุฃ ุฑูุญ ููุงุดุชุฑุงู (ุฃู ุงูุฏุฎูู)
            if(localStorage.getItem('isLoggedIn') === 'true') {
                checkSubscriptionStatus(localStorage.getItem('hn_user_code'));
            } else {
                show('signup'); // ุงุจุฏุฃ ุจุตูุญุฉ ุงูุงุดุชุฑุงู ุงูุฌุฏูุฏุฉ
            }
        }

        function show(id) {
            document.querySelectorAll('.screen').forEach(s => { 
                if(s.id !== id) { s.classList.remove('active'); setTimeout(()=> { if(!s.classList.contains('active')) s.style.display='none'; }, 300); }
            });
            const el = document.getElementById(id); el.style.display = 'flex'; setTimeout(()=>el.classList.add('active'), 10);
        }

        // ------------------------------------------
        // SIGN UP LOGIC (ุงูุฌุฏูุฏ)
        // ------------------------------------------
        function handleSignup(e) {
            e.preventDefault();
            const btn = document.querySelector('#signup-form button');
            const name = document.getElementById('s-name').value;
            const phone = document.getElementById('s-phone').value;
            const plan = document.getElementById('s-plan').value;

            btn.innerText = "ุฌุงุฑู ุงูุชุณุฌูู...";
            btn.disabled = true;

            // ุฅุฑุณุงู ุงูุจูุงูุงุช ููุดูุช
            fetch(API_URL, {
                method: 'POST',
                mode: 'no-cors', // ููู ูุชูุงุฏู ูุดุงูู CORS ูุน ุฌูุฌู
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: `name=${name}&phone=${phone}&plan=${plan}`
            }).then(() => {
                // ุฌูุฌู ูุด ุจูุฑุฏ ุจู JSON ูู ูุถุน no-corsุ ูุจูุนุฑุถ ุฑุณุงูุฉ ูุฌุงุญ ุงูุชุฑุงุถูุฉ
                // ููู ููุง ุณููุงุฌู ูุดููุฉ: ููู ูุนุฑู ุงูููุฏุ 
                // ุงูุญู ุงูุฃูุถู: Apps Script ูุฑุฏ ุจู JSONP ุฃู ูุนุชูุฏ ุนูู GET ููุชุณุฌูู ุฃูุถุงู (ุฃุณูู)
                registerViaGet(name, phone, plan);
            }).catch(err => {
                alert("ุญุฏุซ ุฎุทุฃุ ุชุฃูุฏ ูู ุงูุฅูุชุฑูุช");
                btn.disabled = false;
                btn.innerText = "ุชุณุฌูู";
            });
        }

        // ุงุณุชุฎุฏุงู GET ููุชุณุฌูู (ุฃุถูู ููุญุตูู ุนูู ุงูุฑุฏ ุจุงูููุฏ)
        async function registerViaGet(name, phone, plan) {
            const btn = document.querySelector('#signup-form button');
            try {
                // ุจูุจุนุช ุงูุจูุงูุงุช ูุฃููุง login ุจุณ ุจุจุงุฑุงููุชุฑุงุช ุฒูุงุฏุฉ
                // ูุงุฒู ูุนุฏู ุงูุณูุฑูุจุช ูู ุฌูุฌู ููููู ุฅู ุฏู ุชุณุฌูู (ุจุณ ุฎูููุง ูุณุชุฎุฏู POST ูู ุงูุณูุฑูุจุช ุฃุญุณู)
                // ุงูุญู ุงูุจุฏูู ุงูุณุฑูุน: ูู ุงูุณูุฑูุจุช doGet ุถูู ุดุฑุท ูู ููู name ู phone ูุจูู ุฏู ุชุณุฌูู
                
                // โ๏ธ ุชุนุฏูู: ุณูุณุชุฎุฏู POST ุจุดูู ุตุญูุญ ุนุจุฑ form submission ุฎูู ุฃู ูุนุฏู doGet ูู ุงูุณูุฑูุจุช
                // ูุชุจุณูุท ุงูุฃูุฑ ุนููู: ุณูููู ุจุชูููุฏ ุงูููุฏ ููุง ูุนุฑุถูุ ุซู ุฅุฑุณุงูู ููุณูุฑูุฑ ููุญูุธู "Pending"
                
                // 1. ุชูููุฏ ููุฏ
                const code = Math.floor(100000 + Math.random() * 900000);
                
                // 2. ุฅุฑุณุงู ุงูุจูุงูุงุช ููุณูุฑูุฑ ููุญูุธูุง
                // ููุณุชุฎุฏู fetch GET ูุณูููุฉ ุงูุชุนุงูู ูุน ุงูุฑุฏ
                // (ููุงุญุธุฉ: ุฏู ูุชุทูุจ ุชุนุฏูู ุจุณูุท ูู Apps Script doGet ููุนุงูุฌ ุงูุชุณุฌูู)
                // ูููุ ุนุดุงู ูููุฎุจุทูุดุ ุฎูููุง ูุณุชุฎุฏู ุงูุทุฑููุฉ ุงููู ูุงุชุช ูู ุงูุณูุฑูุจุช doPost
                
                // ุงูุนูุฏุฉ ูุฎุทุฉ ุงูู POST:
                // ุจูุง ุฃู no-cors ูุง ูุนูุฏ ุฏุงุชุงุ ุณูุฌุนู ุงูุณูุฑูุจุช ูุฑุณู ุงูููุฏ ูุงุชุณุงุจุ ููููู ููุนููู "ููุตูู ูุงุชุณุงุจ"
                // ุฃู ูุธูุฑ ูู ุฑุณุงูุฉ: "ุชู ุงูุชุณุฌููุ ุชูุงุตู ูุนูุง ูุงุชุณุงุจ ูุชูุนูู ุญุณุงุจู ุจุฑูู ุชูููููู"
                
                document.getElementById('signup-form').style.display = 'none';
                document.getElementById('signup-footer').style.display = 'none';
                document.getElementById('success-msg').style.display = 'block';
                document.getElementById('generated-code').innerText = "ุชู ุงูุฅุฑุณุงู"; 
                document.querySelector('#success-msg p').innerText = "ุชู ุงุณุชูุงู ุทูุจู! ุชูุงุตู ูุนูุง ุนูู ุงููุงุชุณุงุจ ูููููุง ุงุณูู ูุชูุนูู ุงูุงุดุชุฑุงู ูุงุณุชูุงู ุงูููุฏ.";
                
            } catch(e) {
                console.error(e);
            }
        }
        
        // ------------------------------------------
        // LOGIN LOGIC
        // ------------------------------------------
        async function login() {
            const val = document.getElementById('pass').value;
            const btn = document.querySelector('#login .btn-gold');
            const errorMsg = document.getElementById('error');
            
            // ุจุตูุฉ ุงูุฌูุงุฒ
            let deviceId = localStorage.getItem('hn_device_id');
            if (!deviceId) {
                deviceId = 'dev_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('hn_device_id', deviceId);
            }

            btn.innerText = "ุฌุงุฑู ุงูุชุญูู...";
            btn.disabled = true;
            errorMsg.style.display = 'none';

            try {
                const response = await fetch(`${API_URL}?code=${val}&deviceId=${deviceId}`);
                const data = await response.json();

                if (data.valid === true) {
                    localStorage.setItem('isLoggedIn', 'true');
                    localStorage.setItem('hn_user_code', val);
                    show('dashboard');
                } else {
                    throw new Error(data.message);
                }
            } catch (error) {
                errorMsg.style.display = 'block';
                errorMsg.innerText = error.message || "ุฎุทุฃ ูู ุงูุงุชุตุงู";
            } finally {
                btn.innerText = "ุฏุฎูู ๐";
                btn.disabled = false;
            }
        }

        async function checkSubscriptionStatus(code) {
            // (ููุณ ููุฏ ุงูุชุญูู ุงูุณุงุจู)
            let deviceId = localStorage.getItem('hn_device_id');
             try {
                const response = await fetch(`${API_URL}?code=${code}&deviceId=${deviceId}`);
                const data = await response.json();
                if (data.valid === true) show('dashboard', false);
                else {
                    localStorage.removeItem('isLoggedIn');
                    show('login', false);
                    alert(data.message);
                }
            } catch (e) { show('dashboard', false); }
        }

        // ... (ุจุงูู ุฏูุงู ุงูุฃูุนุงุจ ูุงูููุทู) ...

    </script>
</body>
</html>
